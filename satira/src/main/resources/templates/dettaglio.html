<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>La santissima meme</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400..900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
  <link th:href="@{css/post.css}" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
  crossorigin="anonymous"></script>
  
  
</head>

<body class="fc-pb">
  
  <!--NAVBAR-->
  <nav class="navbar navbar-expand-lg fc-fb ">
    <div class="container d-flex navImg ">
      <!-- <a class="navbar-brand" href="#">Navbar</a> -->
      <img th:src="@{immagini/memeLogo.png}" alt="logo" style="width: 10%;">
      <h1 class="p-0"><strong class="fc-t"><a th:href="@{/} " class="text-decoration-none fc-t">LA SANTA
        MEME</a></strong></h1>
        
        <ul class="nav justify-content-end">
          <li class="nav-item">
            <a class="nav-link fc-t fs-4" th:href="@{/adminForm} ">Unisciti a noi</a>
          </li>
          <li class="nav-item">
            <a class="nav-link fc-t fs-4" th:href="@{/loginAdmin} ">Login</a>
          </li>
        </ul>
      </div>
    </nav>
    
    
    <!--POST-->
    <section class="blog-posts grid-system">
      <div class="container">
        <div class="row">
          <div class="col-lg-8">
            <div class="all-blog-posts">
              <div class="row">
                <div class="col-lg-12">
                  <div class="blog-post">
                    <div class="blog-thumb">
                      <img th:src="${post.immaginePost}" alt="img">
                    </div>
                    <div class="down-content">
                      <h2 th:text="${post.titolo}"></h2>
                      <ul class="post-info">
                        <li><a th:text="|Scritto e interpretato da: ${post.admin.nickname}|"></a></li>
                        <li><a th:text="|(${#temporals.format(post.dataPubblicazione, 'dd-MM-yyyy  HH:mm')})|"></a></li>
                      </ul>
                      <p th:text="${post.contenuto}"></p>
                      <div class="post-options">
                        <div class="row">
                          <ul class="post-share">
                            <li><i class="fa fa-share-alt"></i></li>
                            <li><a href="#">Facebook</a>,</li>
                            <li><a href="#"> Twitter</a></li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!--LISTA COMMENTI-->
                <div class="col-lg-12">
                  <div class="sidebar-item comments">
                    <div class="sidebar-heading">
                      <h2>COMMENTI</h2>
                    </div>
                    <div class="content">
                      <ul>
                        <li th:each="commento : ${commenti}" th:if="${commento.post.id == post.id}">
                          <div class="author-thumb">
                          </div>
                          <div class="right-content">
                            <h4><span th:if="${commento.post.id == post.id}"
                              th:text="${#temporals.format(commento.dataCommento, 'dd-MM-yyyy | HH:mm')}"></span></h4>
                              <h5 th:text="${commento.testo}"></h5>
                              <!-- Mostra l'immagine se presente -->
                              <div th:if="${commento.immagineCommento != null && commento.immagineCommento != ''}">
                                <img th:src="${commento.immagineCommento}" alt="Immagine commento" class="img-fluid mt-2"
                                style="max-width: 100%; max-height: 300px;">
                              </div>
                            </div>
                          </li>
                          
                        </ul>
                      </div>
                    </div>
                  </div>
                  
                  <!--INSERISCI COMMENTO-->
                  <div class="col-lg-12">
                    <div class="sidebar-item submit-comment">
                      <div class="sidebar-heading">
                        <h2>COMMENTA</h2>
                      </div>
                      <div class="content">
                        <form id="comment" action="/aggiungicommento" method="post" enctype="multipart/form-data">
                          <div class="row">
                            <input type="hidden" name="postId" th:value="${post.id}">
                            
                            <!-- Carosello Bootstrap -->
                            <section class="containerCustom py-5">
                              <div id="carouselGif" class="carousel slide py-5">
                                <!-- Indicatori -->
                                <div class="carousel-indicators" id="carousel-indicators">
                                  <!-- Verranno creati dinamicamente -->
                                </div>
                                <!-- Contenuto -->
                                <div class="carousel-inner" id="carousel-inner">
                                  <!-- Slide di placeholder iniziale -->
                                  <div class="carousel-item active">
                                    <img src="immagini/no_img.png" class="d-block w-100" alt="Placeholder">
                                  </div>
                                </div>
                                <!-- Bottoni di controllo -->
                                <button class="carousel-control-prev" type="button" data-bs-target="#carouselGif" data-bs-slide="prev">
                                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                  <span class="visually-hidden">Precedente</span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#carouselGif" data-bs-slide="next">
                                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                  <span class="visually-hidden">Successivo</span>
                                </button>
                              </div>
                            </section>
                            
                            <!-- Campo nascosto per memorizzare l'URL della GIF selezionata -->
                            <input type="hidden" id="immagine" name="immagine" value="">
                            
                            <!-- Fieldset per la ricerca e il commento -->
                            <fieldset>
                              <input type="text" id="search" placeholder="Cerca Gif…">
                              <button type="button" onclick="getGif();" class="btn btn-outline-danger">
                                Cerca Gif
                              </button>
                              <textarea name="testo" rows="6" id="testo" placeholder="Scrivi il tuo commento" required></textarea>
                            </fieldset>
                            
                            <div class="col-lg-12">
                              <fieldset>
                                <button type="submit" id="form-submit" class="main-button">Invia</button>
                              </fieldset>
                            </div>
                          </div>
                        </form>
                        
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="col-lg-4 col-xl-4 px-4 d-flex flex-column">
              <div class="sidebar">
                <div class="col-lg-12">
                  <div class="container">
                    <img src="/immagini/BellsproutGarden.jpg" alt="img">
                  </div>
                </div>
                
                <div class="col-lg-12">
                  <div class="sidebar-item search">
                    <form id="search_form" name="gs" method="GET" action="#">
                      <input type="text" name="q" class="searchText" placeholder="type to search..." autocomplete="on">
                    </form>
                  </div>
                </div>
                
                <div class="col-lg-12">
                  <div class="sidebar-item recent-posts">
                    <div class="sidebar-heading">
                      <h2>Novità:</h2>
                    </div>
                    <div class="content">
                      <ul class="lista-croci">
                        <li th:each="post:${posts}" class="mb-2 recenti">
                          <a th:href="@{/dettaglio(id=${post.id})}" th:text="${post.titolo}"
                          class="text-decoration-none fc-t customFont">
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
</section>

</body>
<script>
  
  async function getGif() {
    const query = document.getElementById('search').value;
    const key = AIzaSyBtXEYbMqI50onTvcfn64bxHGYjtwbH6VA;
    const url = 'https://tenor.googleapis.com/v2/search?q=' + query +
    '&key='+ key +'&limit=10';
    
    try {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(`Errore nella fetch: ${response.status}`);
      }
      const data = await response.json();
      const gifs = data.results;
      
      const carouselInner = document.getElementById('carousel-inner');
      const carouselIndicators = document.getElementById('carousel-indicators');
      
      // Svuota il carosello corrente
      carouselInner.innerHTML = '';
      carouselIndicators.innerHTML = '';
      
      gifs.forEach((gif, index) => {
        const gifUrl = gif.media_formats?.nanogif?.url || gif.item_url || '';
        
        // Crea la slide
        const itemDiv = document.createElement('div');
        itemDiv.classList.add('carousel-item');
        if (index === 0) {
          itemDiv.classList.add('active');
        }
        
        itemDiv.innerHTML = `
        <img src="${gifUrl}" class="d-block w-100" alt="Gif ${index + 1}">
        <div class="carousel-caption d-none d-md-block">
          <h5>${gif.title || ''}</h5>
          <p>${gif.content || ''}</p>
        </div>`;
        
        carouselInner.appendChild(itemDiv);
        
        // Crea l’indicatore per il carosello
        const indicatorButton = document.createElement('button');
        indicatorButton.type = 'button';
        indicatorButton.setAttribute('data-bs-target', '#carouselGif');
        indicatorButton.setAttribute('data-bs-slide-to', index);
        indicatorButton.setAttribute('aria-label', `Slide ${index + 1}`);
        if (index === 0) {
          indicatorButton.classList.add('active');
          indicatorButton.setAttribute('aria-current', 'true');
        }
        carouselIndicators.appendChild(indicatorButton);
      });
      
      // Aggiorna il campo nascosto con l'URL della prima GIF (slide attiva)
      updateHiddenInput();
      
    } catch (error) {
      console.error('Errore durante il recupero delle GIF:', error);
    }
  }
  
  // Funzione per aggiornare il campo nascosto in base alla slide attiva
  function updateHiddenInput() {
    const activeImg = document.querySelector('#carouselGif .carousel-item.active img');
    if (activeImg) {
      document.getElementById("immagine").value = activeImg.src;
    }
  }
  
  // Ascolta l’evento della slide completata e aggiorna il campo
  var carouselElement = document.getElementById('carouselGif');
  carouselElement.addEventListener('slid.bs.carousel', updateHiddenInput);
  
  // Se necessario, imposta il valore iniziale subito dopo la creazione del carosello
  updateHiddenInput();
  
  
  
  
</script>


</html>